function o(t){return new Promise((e,n)=>{t.oncomplete=t.onsuccess=()=>e(t.result),t.onabort=t.onerror=()=>n(t.error)})}function S(t,e){let n;const a=()=>{if(n)return n;const r=indexedDB.open(t);return r.onupgradeneeded=()=>r.result.createObjectStore(e),n=o(r),n.then(c=>{c.onclose=()=>n=void 0},()=>{}),n};return(r,c)=>a().then(p=>c(p.transaction(e,r).objectStore(e)))}let w;function s(){return w||(w=S("keyval-store","keyval")),w}function i(t,e=s()){return e("readonly",n=>o(n.get(t)))}function l(t,e,n=s()){return n("readwrite",a=>(a.put(e,t),o(a.transaction)))}function u(t,e,n=s()){return n("readwrite",a=>new Promise((r,c)=>{a.get(t).onsuccess=function(){try{a.put(e(this.result),t),r(o(a.transaction))}catch(p){c(p)}}}))}function g(t,e=s()){return e("readwrite",n=>(n.delete(t),o(n.transaction)))}const d="draw2ui-projects",f="draw2ui-settings",j={theme:"dark",credits:10},y={async getProjects(){return await i(d)||[]},async createProject(t){const e={id:crypto.randomUUID(),name:t,createdAt:Date.now(),updatedAt:Date.now()};return await u(d,(n=[])=>[...n,e]),await l(`project-${e.id}`,{id:e.id,elements:[],appState:{},generatedHtml:""}),e},async getProjectData(t){return await i(`project-${t}`)},async updateProjectData(t,e){const n=await i(`project-${t}`)||{id:t,elements:[],appState:{},generatedHtml:""};await l(`project-${t}`,{...n,...e}),await u(d,(a=[])=>a.map(r=>r.id===t?{...r,updatedAt:Date.now()}:r))},async deleteProject(t){await u(d,(e=[])=>e.filter(n=>n.id!==t)),await g(`project-${t}`)},async getSettings(){return await i(f)||j},async updateSettings(t){await u(f,(e=j)=>({...e,...t}))}};export{y as d};
